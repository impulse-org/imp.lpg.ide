<html xmlns:v="urn:schemas-microsoft-com:vml"
xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:w="urn:schemas-microsoft-com:office:word"
xmlns:st1="urn:schemas-microsoft-com:office:smarttags"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=ProgId content=Word.Document>
<meta name=Generator content="Microsoft Word 10">
<meta name=Originator content="Microsoft Word 10">
<link rel=File-List
href="Using%20the%20LALR%20Parser%20Generator_files/filelist.xml">
<title>Using the LALR Parser Generator</title>
<o:SmartTagType namespaceuri="urn:schemas-microsoft-com:office:smarttags"
 name="place"/>
<!--[if gte mso 9]><xml>
 <o:DocumentProperties>
  <o:Author>IBM_USER</o:Author>
  <o:LastAuthor>IBM_USER</o:LastAuthor>
  <o:Revision>2</o:Revision>
  <o:TotalTime>6594</o:TotalTime>
  <o:Created>2006-05-31T19:31:00Z</o:Created>
  <o:LastSaved>2006-05-31T19:31:00Z</o:LastSaved>
  <o:Pages>1</o:Pages>
  <o:Words>8380</o:Words>
  <o:Characters>47772</o:Characters>
  <o:Company>IBM</o:Company>
  <o:Lines>398</o:Lines>
  <o:Paragraphs>112</o:Paragraphs>
  <o:CharactersWithSpaces>56040</o:CharactersWithSpaces>
  <o:Version>10.6735</o:Version>
 </o:DocumentProperties>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <w:WordDocument>
  <w:ActiveWritingStyle Lang="EN-US" VendorID="64" DLLVersion="131078"
   NLCheck="1">1</w:ActiveWritingStyle>
  <w:ActiveWritingStyle Lang="FR" VendorID="64" DLLVersion="131078" NLCheck="1">1</w:ActiveWritingStyle>
  <w:SpellingState>Clean</w:SpellingState>
  <w:GrammarState>Clean</w:GrammarState>
  <w:Compatibility>
   <w:BreakWrappedTables/>
   <w:SnapToGridInCell/>
   <w:WrapTextWithPunct/>
   <w:UseAsianBreakRules/>
  </w:Compatibility>
  <w:BrowserLevel>MicrosoftInternetExplorer4</w:BrowserLevel>
 </w:WordDocument>
</xml><![endif]--><!--[if !mso]><object
 classid="clsid:38481807-CA0E-42D2-BF39-B33AF135CC4D" id=ieooui></object>
<style>
st1\:*{behavior:url(#ieooui) }
</style>
<![endif]-->
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:Wingdings;
	panose-1:5 0 0 0 0 0 0 0 0 0;
	mso-font-charset:2;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:0 268435456 0 0 -2147483648 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:"Times New Roman";
	mso-fareast-font-family:"Times New Roman";}
h1
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-font-kerning:16.0pt;}
h2
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:2;
	font-size:14.0pt;
	font-family:Arial;
	font-style:italic;}
h3
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:3;
	font-size:13.0pt;
	font-family:Arial;}
h4
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	page-break-after:avoid;
	mso-outline-level:4;
	font-size:14.0pt;
	font-family:"Times New Roman";}
h5
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:5;
	font-size:13.0pt;
	font-family:"Times New Roman";
	font-style:italic;}
h6
	{mso-style-next:Normal;
	margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	mso-pagination:widow-orphan;
	mso-outline-level:6;
	font-size:11.0pt;
	font-family:"Times New Roman";}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	text-align:center;
	mso-pagination:widow-orphan;
	mso-outline-level:1;
	font-size:16.0pt;
	font-family:Arial;
	mso-fareast-font-family:"Times New Roman";
	mso-font-kerning:14.0pt;
	font-weight:bold;}
p.MsoPlainText, li.MsoPlainText, div.MsoPlainText
	{mso-style-link:" Char";
	margin:0in;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Courier New";
	mso-fareast-font-family:"Times New Roman";}
span.Char
	{mso-style-name:" Char";
	mso-style-link:"Plain Text";
	font-family:"Courier New";
	mso-ascii-font-family:"Courier New";
	mso-hansi-font-family:"Courier New";
	mso-bidi-font-family:"Courier New";
	mso-ansi-language:EN-US;
	mso-fareast-language:EN-US;
	mso-bidi-language:AR-SA;}
span.SpellE
	{mso-style-name:"";
	mso-spl-e:yes;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.25in 1.0in 1.25in;
	mso-header-margin:.5in;
	mso-footer-margin:.5in;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 @list l0
	{mso-list-id:-132;
	mso-list-type:simple;
	mso-list-template-ids:-134478084;}
@list l0:level1
	{mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.25in;
	text-indent:-.25in;}
@list l1
	{mso-list-id:-131;
	mso-list-type:simple;
	mso-list-template-ids:1838814156;}
@list l1:level1
	{mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	margin-left:1.0in;
	text-indent:-.25in;}
@list l2
	{mso-list-id:-130;
	mso-list-type:simple;
	mso-list-template-ids:-2006022980;}
@list l2:level1
	{mso-level-tab-stop:.75in;
	mso-level-number-position:left;
	margin-left:.75in;
	text-indent:-.25in;}
@list l3
	{mso-list-id:-129;
	mso-list-type:simple;
	mso-list-template-ids:2072539172;}
@list l3:level1
	{mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;}
@list l4
	{mso-list-id:-128;
	mso-list-type:simple;
	mso-list-template-ids:841226886;}
@list l4:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:1.25in;
	mso-level-number-position:left;
	margin-left:1.25in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l5
	{mso-list-id:-127;
	mso-list-type:simple;
	mso-list-template-ids:-894555630;}
@list l5:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:1.0in;
	mso-level-number-position:left;
	margin-left:1.0in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l6
	{mso-list-id:-126;
	mso-list-type:simple;
	mso-list-template-ids:1314832822;}
@list l6:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.75in;
	mso-level-number-position:left;
	margin-left:.75in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l7
	{mso-list-id:-125;
	mso-list-type:simple;
	mso-list-template-ids:-529335234;}
@list l7:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
@list l8
	{mso-list-id:-120;
	mso-list-type:simple;
	mso-list-template-ids:-383083078;}
@list l8:level1
	{mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;}
@list l9
	{mso-list-id:-119;
	mso-list-type:simple;
	mso-list-template-ids:-1962774548;}
@list l9:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.25in;
	mso-level-number-position:left;
	margin-left:.25in;
	text-indent:-.25in;
	font-family:Symbol;}
@list l10
	{mso-list-id:1671563618;
	mso-list-type:hybrid;
	mso-list-template-ids:792249498 67698689 67698691 67698693 67698689 67698691 67698693 67698689 67698691 67698693;}
@list l10:level1
	{mso-level-number-format:bullet;
	mso-level-text:\F0B7;
	mso-level-tab-stop:.5in;
	mso-level-number-position:left;
	text-indent:-.25in;
	font-family:Symbol;}
ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>
<!--[if gte mso 10]>
<style>
 /* Style Definitions */
 table.MsoNormalTable
	{mso-style-name:"Table Normal";
	mso-tstyle-rowband-size:0;
	mso-tstyle-colband-size:0;
	mso-style-noshow:yes;
	mso-style-parent:"";
	mso-padding-alt:0in 5.4pt 0in 5.4pt;
	mso-para-margin:0in;
	mso-para-margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:10.0pt;
	font-family:"Times New Roman";}
</style>
<![endif]--><!--[if gte mso 9]><xml>
 <o:shapedefaults v:ext="edit" spidmax="2050"/>
</xml><![endif]--><!--[if gte mso 9]><xml>
 <o:shapelayout v:ext="edit">
  <o:idmap v:ext="edit" data="1"/>
 </o:shapelayout></xml><![endif]-->
</head>

<body lang=EN-US style='tab-interval:.5in'>

<div class=Section1>

<p class=MsoTitle>Using the LALR Parser Generator</p>

<h1>LPG Generator Overview</h1>

<p class=MsoNormal>The LPG system consists of two components: a generator and a
language specific runtime.<span style='mso-spacerun:yes'>  </span>Here we
discuss primarily the generator component.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The generator, lpg.exe, is a C++ program that takes as input
a “grammar” file and produces parsing “tables”, normally expressed as constants
and arrays in an application<span style='mso-spacerun:yes'>  </span>language
(e.g. Java), that together with a parser (provided by the runtime) allow
parsing or scanning of an input string that conforms to the language specified
by the grammar.<span style='mso-spacerun:yes'>  </span>A rule may have
“actions”, that is, statements in the application programming language that are
executed whenever it is “reduced”, that is, when its right-hand side is
parsed.<span style='mso-spacerun:yes'>  </span>Rule actions may be used to
generate an intermediate representation of the input.<span
style='mso-spacerun:yes'>  </span>Often this representation mirrors closely the
syntax and is called an Abstract Syntax Tree (AST).<span
style='mso-spacerun:yes'>  </span>The LPG generator can generate an AST
automatically without user specified actions.<o:p></o:p></p>

<h2>Input Grammar</h2>

<p class=MsoNormal>The input to the LPG generator consists primarily of
language syntax rules expressed in BNF.<span style='mso-spacerun:yes'> 
</span>There is usually more input than just the grammar rules.<span
style='mso-spacerun:yes'>  </span>One must specify “options” to indicate how LPG
should process the grammar.<span style='mso-spacerun:yes'>  </span>The
“actions” must also be specified as well as code used with the actions.<span
style='mso-spacerun:yes'>  </span>To facilitate this, the input file is divided
into “sections”, which we describe in detail below.<span
style='mso-spacerun:yes'>  </span>Here is an example of a grammar file, <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ExprParser.g</span></b></span>
(the extension “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>.g</span></b></span>” is suggested, but any other, or
none, may be used):</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>%options
ast_directory=./ExprAst,automatic_ast=toplevel,var=nt,visitor=default</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options programming_language=java</span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options package=expr1</span></b><b style='mso-bidi-font-weight:normal'><span
lang=FR style='font-size:10.0pt;font-family:"Courier New";mso-ansi-language:
FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options template=dtParserTemplateD.g</span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options import_terminals=ExprLexer.g</span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$Terminals</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><span style='mso-spacerun:yes'>    </span></span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>IntegerLiteral</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>PLUS ::= +</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'> </span>MULTIPLY ::= *</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>LPAREN ::= (</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>RPAREN ::= )</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$end</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$Rules</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:10.0pt;font-family:"Courier New";
background:white;mso-highlight:white;mso-ansi-language:FR'>E ::= E + T</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>        </span>| T</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>    </span>T ::= T * F</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>        </span>| F</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>    </span>F ::= IntegerLiteral</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:10.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>    </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>F$ParenExpr ::= ( E )</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$End</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The options are always first.<span
style='mso-spacerun:yes'>  </span>The first option indicates automatic AST generation
with sub-options to indicate where to put the generated AST classes and
interfaces, how to treat terminal symbols and which kind of visitor to use.<span
style='mso-spacerun:yes'>  </span>The second option specifies the application
programming language; it is Java which LPG will use for generating the actions,
the AST and the parsing tables.<span style='mso-spacerun:yes'>  </span>The next
option, “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>package</span></b></span>”, specifies the Java package
name for the generated code.<span style='mso-spacerun:yes'>  </span>The “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>template</span></b></span>”
option refers to a template file that describes additional options and code needed
to simplify the generation of the parser.<span style='mso-spacerun:yes'> 
</span>Finally, there is an “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>import_terminals</span></b></span>”
option that specifies the scanner (or lexer) that breaks the input into the
“tokens” or terminal symbols to be parsed.<span style='mso-spacerun:yes'> 
</span>The various LPG options (there are many) are described in another
document.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Next there are two “sections”, each indicated by the “escape
symbol” (“<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>$</span></b></span>”) followed by a keyword.<span
style='mso-spacerun:yes'>  </span>The first is “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$Terminals</span></b></span>”
and this section consists simply of a list of the terminal symbols.<span
style='mso-spacerun:yes'>  </span>The other section is “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$Rules</span></b></span>”
which specifies the syntax in BNF rules.<span style='mso-spacerun:yes'> 
</span>The non-terminal and terminal symbols in a rule may be named.<span
style='mso-spacerun:yes'>  </span>The name “<b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>$ParenExpr</span></b>” in the above rule, “<b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>F$ParenExpr ::= ( E )</span></b>”,
names the generated AST rule class.</p>

<h2>Generated Output</h2>

<p class=MsoNormal>The LPG generator always produces a console output listing of
the options used, error diagnostics and various grammar and state machine
properties.<span style='mso-spacerun:yes'>  </span>If the language option is
used, then parsing tables (in text or program format) are generated along with
action code.<span style='mso-spacerun:yes'>  </span>For the simple expression
parser (for which the language is Java) the following files are generated:</p>

<ul style='margin-top:0in' type=disc>
 <li class=MsoNormal style='mso-list:l10 level1 lfo11;tab-stops:list .5in'><span
     class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:
     10.0pt'>ExprParser.java</span></b></span> – the “action” file: <span
     style='mso-spacerun:yes'> </span>a class with methods for invoking the
     runtime parser and the syntactic actions</li>
 <li class=MsoNormal style='mso-list:l10 level1 lfo11;tab-stops:list .5in'><span
     class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:
     10.0pt'>ExprParsersym.java</span></b></span> – the “sym” file: <span
     style='mso-spacerun:yes'> </span>an interface defining the terminal symbol
     representation</li>
 <li class=MsoNormal style='mso-list:l10 level1 lfo11;tab-stops:list .5in'><span
     class=SpellE><span class=Char><b style='mso-bidi-font-weight:normal'><span
     style='font-size:10.0pt'>ExprParserprs.java</span></b></span></span> – the
     “prs” file: <span style='mso-spacerun:yes'> </span>a class defining the
     state machine or parse tables used by the runtime parser</li>
</ul>

<p class=MsoNormal>Since the automatic AST generation option is used, the AST
classes and interfaces are also generated (typically within the action class,
but not in this example).<o:p></o:p></p>

<h2>Language Specific Runtime</h2>

<p class=MsoNormal>LPG runtime support includes input and token stream
management as well as stack based parsers.<span style='mso-spacerun:yes'> 
</span>The Java runtime has two stream classes, called <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexStream</span></b></span>
and <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>PrsStream</span></b></span>.<span
style='mso-spacerun:yes'>  </span>The <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>LexStream</span></b></span> assumes the
input to be parsed (or scanned) is a character array.<span
style='mso-spacerun:yes'>  </span>There are methods to iterate through the
array and to keep track of locations (offsets, line and column).<span
style='mso-spacerun:yes'>  </span>The scanner (or “lexer” as we prefer to name
it), whether it is LPG provided or hand coded, reads characters, classifies
them and produces an array list of “tokens” (called a “token stream”) to be
parsed.<span style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>An LPG lexer action class is typically an extension of <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexStream</span></b></span>
that tokenizes the input character array according to grammar rules using a special
runtime parser, <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>LexParser</span></b></span>.<span
style='mso-spacerun:yes'>  </span>The generated token list is contained in a
token stream class called <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>PrsStream</span></b></span>.<span
style='mso-spacerun:yes'>  </span>An LPG parser action class is normally an
extension of <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>PrsStream</span></b></span> that parses the tokens
according to syntax rules using one of the provided runtime parsers, the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>DeterministicParser</span></b></span>
or the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>BacktrackingParser</span></b></span>.<span
style='mso-spacerun:yes'>  </span>Lexers and parsers can detect and report
errors.<span style='mso-spacerun:yes'>  </span>An LPG parser will normally
raise an exception and terminate when the first error is encountered.<span
style='mso-spacerun:yes'>  </span>However, the user may instruct the parser to
invoke the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>DiagnoseParser</span></b></span> to parse the entire
input to diagnose all syntax errors.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>To simplify building lexers and parsers, the LPG Java
runtime also contains “templates” describing the user’s action class.<span
style='mso-spacerun:yes'>  </span>A template is not a real class (or code) but
a parameterized class fragment.<span style='mso-spacerun:yes'> 
</span>Parameterization is achieved by macro definitions (much like the
“define” macros in C).<span style='mso-spacerun:yes'>  </span>The simple
expression example shown above uses a template, <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>dtParserTemplateD.g</span></b> to define its action
class and method of invoking actions.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Finally, the LPG Java runtime contains some useful code
sections (called “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>$Header</span></b></span>” sections) that may be
included in a lexer grammar file.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The LPG runtime is very language specific.<span
style='mso-spacerun:yes'>  </span>At this time only the Java runtime has all of
the features described here.<span style='mso-spacerun:yes'>  </span>For C/C++
there is only a deterministic parser and prs and sym files.<span
style='mso-spacerun:yes'>  </span>We hope to expand the C/C++ runtime in the
future and bring it to the same level as the Java runtime.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h2>Putting the Pieces Together</h2>

<p class=MsoNormal>Let’s use the simple expression grammar example to
illustrate the process of building an LPG lexer and parser.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3>The Main Program</h3>

<p class=MsoNormal>First we show a driver program that will invoke the lexer
and parser in succession and “visit” the automatically generated AST.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'>package
expr1;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'>import
expr1.ExprAst.*;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>public class </span></b><st1:place><b
 style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
 "Courier New"'>Main</span></b></st1:place><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>       </span>public static void main(String[] args)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:FR'>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><span
style='mso-spacerun:yes'>        </span>Option option;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><span
style='mso-spacerun:yes'>        </span>ExprLexer Expr_lexer;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><span
style='mso-spacerun:yes'>        </span>ExprParser Expr_parser;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><span
style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'>      </span>Ast ast;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span lang=FR
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><span
style='mso-spacerun:yes'>        </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'>try<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>option = new Option(args);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>option.readInputChars();<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>Expr_lexer = <span
style='mso-tab-count:1'>  </span>// Create the lexer<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'>new
ExprLexer(option.getInputChars(), option.getFileName()); <o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:FR'>Expr_parser = <span style='mso-tab-count:1'> </span>//
Create </span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>the</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'> parser<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:.5in'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'>new ExprParser(Expr_lexer);<span
style='mso-tab-count:1'> </span></span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>// Lex the stream to produce the
token stream<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:FR'>Expr_lexer.lexer(Expr_parser);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span style='mso-tab-count:
1'>       </span><span style='mso-spacerun:yes'>     </span>// Parse the token
stream to produce an AST<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>ast = Expr_parser.parser();<span
style='mso-spacerun:yes'>            </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span>if (ast != null) <o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>           </span><span
style='mso-spacerun:yes'>     </span>Integer result = (Integer)ast.accept(new ExprResultVisitor());<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                </span>System.out.println(&quot;The
value is : &quot; + result.intValue());<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>return;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>catch (Exception e)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>System.err.println(e.getMessage());<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>e.printStackTrace();<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>There are several things to notice about this driver.<span
style='mso-spacerun:yes'>  </span>First, the AST classes are in a separate
imported package because the parser uses the <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>ast_directory</span></b> option.<span
style='mso-spacerun:yes'>  </span>Next, an option class (not shown here) is
used to read the input file so that the input character array and file name can
be passed to the lexer constructor.<span style='mso-spacerun:yes'>  </span>A
lexer and parser are created with the latter taking the former as an
argument.<span style='mso-spacerun:yes'>  </span>The lexer is a subclass of <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexStream</span></b></span>
and the parser is a subclass of <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>.<span
style='mso-spacerun:yes'>  </span>These two objects are actually linked
together when the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>lexer</span></b></span>” method is invoked.<span
style='mso-spacerun:yes'>  </span>The result of lexing is the list of tokens
which is known to the parser.<span style='mso-spacerun:yes'>  </span>The call
on the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>parser</span></b></span>” method does the actual
parsing and produces an AST object which is then “visited” to evaluate the
expression.<span style='mso-spacerun:yes'>  </span>The visitor approach to
traversing the AST will not be fully discussed in this document.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3>The Lexer</h3>

<p class=MsoNormal>Next we examine the lexer.<span style='mso-spacerun:yes'> 
</span>This is the grammar file:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%Options la=2<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%options package=expr1<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%options
template=LexerTemplateD.g<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%options export_terminals=(&quot;ExprParsersym.java&quot;,
&quot;TK_&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$Export<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>IntegerLiteral PLUS MULTIPLY LPAREN RPAREN<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$End<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$Headers<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>/.<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>final void makeToken(int kind)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>int startOffset = getLeftSpan(),
endOffset = getRightSpan();<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>makeToken(startOffset, endOffset,
kind);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public final int getKind(int i)<span
style='mso-spacerun:yes'>  </span>// Classify character at ith location<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>char c = (i &gt;= getStreamLength()
? '\uffff' : getCharValue(i));<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>return (c &lt;<span
style='mso-spacerun:yes'>  </span>33<span style='mso-tab-count:2'>       </span>?
Char_WSChar : <o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='mso-tab-count:2'>         </span>c&gt;=
'0' &amp;&amp; c &lt;= '9' ? Char_Digit :<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='mso-tab-count:2'>         </span>c
== '+' <span style='mso-tab-count:2'>            </span>? Char_Plus :<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='mso-tab-count:2'>         </span>c
== '*' <span style='mso-tab-count:2'>            </span>? Char_Star :<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='mso-tab-count:2'>         </span>c
== '(' <span style='mso-tab-count:2'>            </span>? Char_LeftParen :<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='mso-tab-count:2'>         </span>c
== ')' <span style='mso-tab-count:2'>            </span>? Char_RightParen :<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='mso-tab-count:2'>         </span>c
== '\uffff' <span style='mso-tab-count:1'>       </span>? Char_EOF : <o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span><span style='mso-tab-count:5'>                             </span><span
style='mso-spacerun:yes'>  </span>Char_Unused);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>./<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$End<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$Terminals<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>WSChar Digit Unused EOF<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Plus<span style='mso-spacerun:yes'>        
</span>::= '+'<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Star<span style='mso-spacerun:yes'>        
</span>::= '*'<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>LeftParen<span style='mso-spacerun:yes'>   
</span>::= '('<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>RightParen<span style='mso-spacerun:yes'>  
</span>::= ')'<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$End<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$Start<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Token<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$End<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$Rules<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>   </span>Token ::= IntegerLiteral<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>/.$BeginAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                   
</span>makeToken($_IntegerLiteral);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span>$EndAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>./<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Token ::= '+'<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>/.$BeginAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                    </span>makeToken($_PLUS);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span>$EndAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>./<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Token ::= '*'<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>     </span><span
style='mso-spacerun:yes'>   </span>/.$BeginAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                    </span>makeToken($_MULTIPLY);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span>$EndAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>./<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Token ::= '('<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>/.$BeginAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                    </span>makeToken($_LPAREN);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span>$EndAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>./<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Token ::= ')'<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>/.$BeginAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><span
style='mso-spacerun:yes'>            </span>makeToken($_RPAREN);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>          </span>$EndAction<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>./<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>Token ::= WS -- White Space is scanned and
ignored<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>IntegerLiteral -&gt; Digit <o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span><span style='mso-tab-count:3'>                 </span>|
IntegerLiteral Digit<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>WS -&gt; WSChar<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>| WS WSChar<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$End<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:FR'><span
style='mso-spacerun:yes'> </span><span lang=FR><o:p></o:p></span></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The Options</h5>

<p class=MsoNormal>Lexer generation is guided by the <b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'>LexerTemplateD</span></b>
template.<span style='mso-spacerun:yes'>  </span>This template has additional
LPG options.<span style='mso-spacerun:yes'>  </span>These include:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%Options
programming_language=java,margin=4<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%options
action=(&quot;*.java&quot;, &quot;/.&quot;, &quot;./&quot;)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%options
ParseTable=lpg.lpgjavaruntime.ParseTable<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>%Options prefix=Char_<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>action</span></b></span>” option indicates that the
action class is named with the grammar file prefix and uses “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>/.</span></b></span>”
and “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>./</span></b></span>” as action code delimiters.<span
style='mso-spacerun:yes'>  </span>The “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>ParseTable</span></b></span>” option indicates
the location of the Java ParseTable interface (which specifies the methods the runtime
parsers use to access the parse constants and table arrays).<span
style='mso-spacerun:yes'>  </span>This option must be specified for every LPG
lexer or parser.<span style='mso-spacerun:yes'>  </span>The “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>prefix</span></b></span>”
option specifies the prefix applied to terminal symbol names to ensure there
will be no conflicts with Java keywords.<span style='mso-spacerun:yes'> 
</span>It is required that terminal symbols be acceptable Java identifiers
(since they just name integer constants in the symbol file) so the prefix may
be necessary.<span style='mso-spacerun:yes'>  </span>Finally, the “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>export_terminals</span></b></span>”
option indicates the symbol file for the exported symbols and their
prefix.<span style='mso-spacerun:yes'>  </span>A parser that imports this lexer
need not use the same symbol file, but it must use the same prefix.<span
style='mso-spacerun:yes'>  </span>It is recommended that the prefix “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>TK_</span></b></span>”
be used for exported symbols.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>There are other important parts to the template that are
discussed below.</p>

<h5>The Export Section</h5>

<p class=MsoNormal>The first section in this example lexer is an “export”
section.<span style='mso-spacerun:yes'>  </span>The export section is signaled
by the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>$Export</span></b></span>” heading and ended by “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$End</span></b></span>”
or another section header.<span style='mso-spacerun:yes'>  </span>We recommend
that all sections be terminated by a “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>$End</span></b></span>”.<span
style='mso-spacerun:yes'>  </span>We note here that sections may appear in any
order and a given section may appear more than once (multiple instances being
concatenated together).<span style='mso-spacerun:yes'>  </span>The export
section lists the terminal symbols that are exported to a parser.<span
style='mso-spacerun:yes'>  </span>An export symbol file is created for these
symbols (with the name and prefix specified in the “export” option, if given,
or with the lexer grammar file prefix suffixed with “ext” and no token prefix,
if there is no export option).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The Headers Section</h5>

<p class=MsoNormal>The “headers” section provides additional action class
methods that are not provided in the template.<span style='mso-spacerun:yes'> 
</span>For most LPG lexers the two methods shown here are needed and one of
them, the <b style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;
font-family:"Courier New"'>getKind</span></b> method cannot easily be incorporated
into a general purpose template.<span style='mso-spacerun:yes'>  </span>There
are “include” files in the LPG distribution that may obviate the need for a
special “headers” section in the lexer grammar file.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The first method in this section, <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'>makeToken</span></b>,
actually creates a token and adds it to the array list of tokens.<span
style='mso-spacerun:yes'>  </span>To do this it invokes the corresponding
method in <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>LexStream</span></b></span> passing it the starting
and ending indexes of the token in the input character array and the token
kind.<span style='mso-spacerun:yes'>  </span>The <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexStream</span></b></span>
method, <b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;
font-family:"Courier New"'>makeToken</span></b>, refers to method with the same
name in <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>PrsStream</span></b></span> and it is this method that
constructs the token and adds it to the list.<span style='mso-spacerun:yes'> 
</span>A Token class is defined in the LPG Java runtime.<span
style='mso-spacerun:yes'>  </span>A token instance has offsets and a
“kind”.<span style='mso-spacerun:yes'>  </span>The token kind is just an
integer that is defined in the symbol file.<span style='mso-spacerun:yes'> 
</span>The runtime parser uses the token kind to determine its next move.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The other method, <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>getKind</span></b>, gets the
character kind of the input character being lexed (as in the parser it gets the
token kind of the token being parsed).<span style='mso-spacerun:yes'> 
</span>In a lexer the “tokens” are the input characters.<span
style='mso-spacerun:yes'>  </span>This method, then, classifies the input
character as a lexer terminal symbol.<span style='mso-spacerun:yes'> 
</span>This example is simple so if-then-else style logic is used.<span
style='mso-spacerun:yes'>  </span>In more complex cases, one would use an array
to map at least the basic ASCII characters to their kinds.<o:p></o:p></p>

<h5>The Terminals Section</h5>

<p class=MsoNormal>The next section is the “terminals” section, signaled by “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$Terminals</span></b></span>”.<span
style='mso-spacerun:yes'>  </span>Note that the names are legal Java
identifiers, but some of them, <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>Plus</span></b></span> and <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Star</span></b></span>,
for example, are often denoted by operator characters.<span
style='mso-spacerun:yes'>  </span>Thus, in the rule defining the token <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Plus</span></b></span>
we use the symbol ‘<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>+</span></b></span>’ which is an “alias” for the
terminal symbol <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>Plus.</span></b></span><span
style='mso-spacerun:yes'>  </span>This association can be specified using an
“alias” section or by defining it in the “terminals” section as we have done
above.</p>

<h5>The Start Section</h5>

<p class=MsoNormal>The “Start” section specifies the root or starting
non-terminal.<span style='mso-spacerun:yes'>  </span>Rules that are not
derivable from the start symbol are useless and have no effect.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In a lexer the start symbol stands for the class of tokens
to be scanned.<span style='mso-spacerun:yes'>  </span>Usually tokens are simple
and largely independent of each other.<span style='mso-spacerun:yes'> 
</span>This is certainly the case in our example where the only recursive rules
are for recognizing <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>IntegerLiteral</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'> </span></b>and<span style='mso-spacerun:yes'>  </span>white
space.<span style='mso-spacerun:yes'>  </span>Thus, we use a special runtime
parser, <span class=Char><b><span style='font-size:10.0pt'>LexParser</span></b></span>,
in most lexers.<span style='mso-spacerun:yes'>  </span>The <span class=Char><b><span
style='font-size:10.0pt'>LexParser</span></b></span> is simply a token
recognition loop that resets to the start state as each token is recognized –
it behaves just like a hand written scanner.<span style='mso-spacerun:yes'> 
</span>This means that the start symbol describes the class of tokens, not a
list of tokens.<span style='mso-spacerun:yes'>  </span>It is possible (and
sometimes necessary) to use an actual parser (such as the <span class=Char><b><span
style='font-size:10.0pt'>DeterministicParser</span></b></span>) and recognize a
token list.<span style='mso-spacerun:yes'>  </span>Lexer construction will be
discussed in a separate document on lexer construction.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The Rules Section</h5>

<p class=MsoNormal>This section provides the token recognition rules for
expressions.<span style='mso-spacerun:yes'>  </span>The tokens are the
operators, parentheses, integer literals and white space.<span
style='mso-spacerun:yes'>  </span>One should note how the actions are
specified.<span style='mso-spacerun:yes'>  </span>No action is specified for
white space so it is simply ignored.<span style='mso-spacerun:yes'>  </span>For
the other tokens the action is to construct an exported token using the <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'>makeToken</span></b> method described above.<span
style='mso-spacerun:yes'>  </span>Note that to pass the exported token kind argument
a special predefined macro, <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>$_</span></b>, is prefixed
to the exported token name.<span style='mso-spacerun:yes'>  </span>The macro is
replaced by the prefix specified for the exported symbol file, <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'>TK_</span></b>, in our case.<span style='mso-spacerun:yes'> 
</span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Note also the macros <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>$BeginAction</span></b> and <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'>$EndAction</span></b> surrounding the action code.<span
style='mso-spacerun:yes'>  </span>These macros are defined in the lexer
template and are specific to the implementation of rule actions.<span
style='mso-spacerun:yes'>  </span>This is discussed in detail below.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The Action Class<o:p></o:p></h5>

<p class=MsoNormal>The “lexer” from the user’s point of view is the object
performing the token recognition actions.<span style='mso-spacerun:yes'> 
</span>It is therefore necessary, but somewhat complicated, to define the
action class.<span style='mso-spacerun:yes'>  </span>To facilitate this LPG
provides lexer templates.<span style='mso-spacerun:yes'>  </span>Our example
uses <b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;
font-family:"Courier New"'>LexerTemplateD</span></b>.<span
style='mso-spacerun:yes'>  </span>The template has a “headers” section that
defines most (but not all, as noted below) of the action class and associated
methods as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$Headers<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>/.<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>public class $action_type <o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:.5in'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'>extends $super_stream_class <o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:.5in;text-indent:.5in'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'>implements $exp_type, $sym_type,
RuleAction$additional_interfaces<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>private static ParseTable prs = new
$prs_type();<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>private $prs_stream_class prsStream;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>private LexParser lexParser = new
LexParser(this, prs, this);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public $prs_stream_class getPrsStream()
{ return prsStream; }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>      </span><span style='mso-spacerun:yes'>  </span>public
int getToken(int i) { return lexParser.getToken(i); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span>public int getRhsFirstTokenIndex(int i) <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span>{ return lexParser.getFirstToken(i); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span>public int getRhsLastTokenIndex(int i) <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span>{ return lexParser.getLastToken(i); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public int getLeftSpan() { return
lexParser.getFirstToken(); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span>public int getRightSpan() { return
lexParser.getLastToken(); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public $action_type(String filename,
int tab) <o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:2.5in;text-indent:.5in'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'>throws java.io.IOException <o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{ super(filename, tab); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public $action_type(char[] input_chars,
String filename, int tab)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{ super(input_chars, filename, tab); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public $action_type(char[] input_chars,
String filename)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{ this(input_chars, filename, 1); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public $action_type() {}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public String[] orderedExportedSymbols()
<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span>{ return $exp_type.orderedTerminalSymbols; }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in'><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'> </span>public LexStream getLexStream() { return
(LexStream) this; }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public void lexer($prs_stream_class
prsStream)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{ lexer(null, prsStream); }<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>public void lexer(Monitor monitor,
$prs_stream_class prsStream)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>{<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>if (getInputChars() == null)<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                </span>throw new
NullPointerException(&quot;LexStream not initialized&quot;);<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>this.prsStream = prsStream;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>prsStream.makeToken(0, 0, 0); // first
entry has a “bad” token<span style='mso-spacerun:yes'>                 </span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>           
</span>lexParser.parseCharacters(monitor);<span style='mso-spacerun:yes'> 
</span>// Lex the input characters<span style='mso-spacerun:yes'>              
</span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>int i = getStreamIndex();<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>prsStream.makeToken(i, i,
$eof_token); // last has end of file<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>           
</span>prsStream.setStreamLength(prsStream.getSize());<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>                </span><o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>            </span>return;<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>        </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><span
style='mso-spacerun:yes'>    </span>./<o:p></o:p></span></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'>$End<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>This headers section is difficult to read (much less to
understand) because of the number of macros it uses.<span
style='mso-spacerun:yes'>  </span>Rather than delve into these macros let us
see the Java class LPG has generated:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public class ExprLexer extends LpgLexStream <o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-left:1.0in;text-indent:.5in'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'> </span>implements ExprParsersym, ExprLexersym,
RuleAction<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>private
static ParseTable prs = new ExprLexerprs();<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>private
PrsStream prsStream;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>private
LexParser lexParser = new LexParser(this, prs, this);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
PrsStream getPrsStream() { return prsStream; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public int
getToken(int i) { return lexParser.getToken(i); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public int
getRhsFirstTokenIndex(int i) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
lexParser.getFirstToken(i); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public int
getRhsLastTokenIndex(int i) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
lexParser.getLastToken(i); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public int
getLeftSpan() <span style='mso-spacerun:yes'> </span>{ return
lexParser.getFirstToken(); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public int
getRightSpan() { return lexParser.getLastToken(); <span
style='mso-spacerun:yes'> </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
ExprLexer(String filename, int tab) throws java.io.IOException <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ super(filename,
tab); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
ExprLexer(char[] input_chars, String filename, int tab)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ super(input_chars,
filename, tab); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
ExprLexer(char[] input_chars, String filename)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ this(input_chars,
filename, 1); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
ExprLexer() {}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
String[] orderedExportedSymbols() <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
ExprParsersym.orderedTerminalSymbols; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
LexStream getLexStream() { return (LexStream) this; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
lexer(PrsStream prsStream)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ lexer(null,
prsStream); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
lexer(Monitor monitor, PrsStream prsStream)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ if
(getInputChars() == null)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span>throw
new NullPointerException(&quot;LexStream was not initialized&quot;);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>this.prsStream
= prsStream;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>prsStream.makeToken(0, 0, 0); // first entry has a “bad” token<span
style='mso-spacerun:yes'>        </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>lexParser.parseCharacters(monitor);<span style='mso-spacerun:yes'> 
</span>// Lex the input characters<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>int i =
getStreamIndex();<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>prsStream.makeToken(i, i, TK_EOF_TOKEN); // last has end of file<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>prsStream.setStreamLength(prsStream.getSize());<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span><o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>return;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:8.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>As we mentioned before the lexer action class, <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'>ExprLexer,</span></b> extends <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'>LexStream</span></b>
(actually it extends <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>LpgLexStream</span></b>,
which is an abstract subclass of <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>LexStream</span></b> that
forces the method <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>getKind</span></b> to be
defined).<span style='mso-spacerun:yes'>  </span>The class also implements
three interfaces, <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>ExprParsersym, ExprLexersym </span></b>and<b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'> RuleAction.</span></b><span style='mso-spacerun:yes'> 
</span>The first two are the symbol interfaces for the lexer terminal symbols
and the exported terminal symbols.<span style='mso-spacerun:yes'>  </span>The
last is the rule action interface signifying that the action class implements <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ruleAction</span></b></span>
method used by the runtime parser (<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>LexParser</span></b></span> in this
case) to invoke the appropriate action code whenever a rule is reduced (we
describe this method below).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>This class has three constructors with which you specify the
input file, the character array and the tab value.<span
style='mso-spacerun:yes'>  </span>The input file name may be given as the empty
string, signifying that there isn’t one.<span style='mso-spacerun:yes'> 
</span>This name appears in default error messages and the parsing application
can access it through the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>LexStream</span></b></span> method <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>getFileName.
</span></b></span><span style='mso-spacerun:yes'> </span>The tab value is used
to ensure token starting and ending columns are correctly located in
messages.<span style='mso-spacerun:yes'>  </span>It is not necessary to specify
an input character array when creating a lexer object; one might create the
lexer once and use it many times giving each time a new or modified character
array using methods that are provided in <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>LexStream</span></b></span>.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The action class needs access to a parser and a parse
stream.<span style='mso-spacerun:yes'>  </span>The parser needs access to the
parse tables the lexer will use.<span style='mso-spacerun:yes'>  </span>Thus,
three private variables are declared:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>private static ParseTable prs = new
ExprLexerprs();<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>private PrsStream prsStream;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>private LexParser lexParser = new
LexParser(this, prs, this);<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The first is for the parse table class, <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>ExprLexerprs</span></b>, a class which
implements the <b style='mso-bidi-font-weight:normal'><span style='font-size:
10.0pt'>ParseTable</span></b> interface.<span style='mso-spacerun:yes'> 
</span>In order to create the token stream, a <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>
is declared; this will be an argument to the <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>lexer</span></b></span>
method.<span style='mso-spacerun:yes'>  </span>Finally, the runtime parser used
is the <b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexParser</span></b>.<span
style='mso-spacerun:yes'>  </span>Note that its constructor takes <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>TokenStream</span></b></span>,
<span class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:
10.0pt'>ParseTable</span></b></span> and <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>RuleAction</span></b></span>
instances.<span style='mso-spacerun:yes'>  </span>The action class itself<span
style='mso-spacerun:yes'>  </span>is the token stream (since it extends <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexStream</span></b></span>)
as well as the rule action (since it implements <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>RuleAction</span></b></span>).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>lexer</span></b></span> method calls the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexParser</span></b></span>
to parse the input character array and build the list of tokens.<span
style='mso-spacerun:yes'>  </span>A <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>, which will
hold the list of exported tokens, is the principal argument and is typically an
instance of the parser’s action class (since that class normally extends <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>).<span
style='mso-spacerun:yes'>  </span>There is also a <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Monitor</span></b></span>
argument which is usually “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>null</span></b></span>” unless one wants
to limit the time allocated to lexing.<span style='mso-spacerun:yes'> 
</span>Note: an unused (“zero”) token starts the list and an end-of-file token
ends the list.<span style='mso-spacerun:yes'>  </span>A place holder at the
beginning of the list is needed by the parser.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>We see several methods that may be invoked by the actions
themselves: methods to get the <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>LexStream</span></b></span> and the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>
(in order to access their methods), and methods to get the span of terminals
and rule right-hand sides in the input character array.<span
style='mso-spacerun:yes'>  </span>We remarked above that the headers section in
the lexer grammar file defined a <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>makeToken </span></b></span>method that referenced
the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>makeToken </span></b></span>method of <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexStream</span></b></span>,
which in turn referenced the one in <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>.<span
style='mso-spacerun:yes'>  </span>This method could have referenced the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>
method directly as <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>prsStream.makeToken(...)</span></b></span>.<span
style='mso-spacerun:yes'>  </span>The getLeftSpan and getRightSpan methods are
used to find the left-most and right-most character locations spanned by a
rule.<span style='mso-spacerun:yes'>  </span>In fact we see these methods used
in the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>makeToken </span></b></span>method discussed
above.<span style='mso-spacerun:yes'>  </span>The other location methods are
quite useful and are documented elsewhere.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The Rule Action Method</h5>

<p class=MsoNormal>Finally, we must explain the connection between the runtime
parser (the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>LexParser</span></b></span>) and the user written rule
actions.<span style='mso-spacerun:yes'>  </span>The parser invokes the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ruleAction</span></b></span>
method, defined by the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>RuleAction</span></b></span> interface and implemented
by the action class, whenever a rule is reduced (that is, whenever its
right-hand side has been parsed) passing the LPG assigned rule number as
argument.<span style='mso-spacerun:yes'>  </span>LPG provides two rule action
implementations in the templates: one uses a select statement and the other
defines a class for each rule containing a method to be executed when the rule
is reduced.<span style='mso-spacerun:yes'>  </span>The select implementation is
simpler and for Java the more efficient one (however, for C++ the other is more
efficient) so it is illustrated here.<span style='mso-spacerun:yes'> 
</span>Simply by changing the template one can switch transparently from one to
the other.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In the lexer Java code we find ruleAction as the last method
listed.<span style='mso-spacerun:yes'>  </span>We shall first examine it and
then relate it back to the template and the grammar file actions.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>public void ruleAction( int ruleNumber)<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>{<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>        </span>switch(ruleNumber) {<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>// Rule 1:<span
style='mso-spacerun:yes'>  </span>Token ::= IntegerLiteral<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>case 1: { <o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>makeToken(TK_IntegerLiteral);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>break;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'>         </span>}<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'> </span><span style='mso-spacerun:yes'>          
</span>// Rule 2:<span style='mso-spacerun:yes'>  </span>Token ::= +<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>case 2: { <o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>makeToken(TK_PLUS);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>break;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>}<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>// Rule 3:<span
style='mso-spacerun:yes'>  </span>Token ::= *<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>case 3: { <o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>makeToken(TK_MULTIPLY);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>              </span><span
style='mso-spacerun:yes'>  </span>break;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>}<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>// Rule 4:<span
style='mso-spacerun:yes'>  </span>Token ::= (<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>case 4: { <o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>makeToken(TK_LPAREN);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>break;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>}<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>// Rule 5:<span
style='mso-spacerun:yes'>  </span>Token ::= )<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>case 5: { <o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>makeToken(TK_RPAREN);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'>              </span>break;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>}<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>            </span>default:<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>                </span>break;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>        </span>}<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>        </span>return;<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>}<o:p></o:p></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The code is self explanatory, but how did it get there?<span
style='mso-spacerun:yes'>  </span>In the template there is a rules section with
a special macro <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>$BeginActions</span></b></span>.<span
style='mso-spacerun:yes'>  </span>This is macro is defined in the “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$Define</span></b></span>”
section of the template as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>$BeginActions</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>/.</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public void ruleAction( int ruleNumber)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>switch(ruleNumber)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{./</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Since the template’s rules section is the first rules section
the ruleAction method is started after the template’s headers code but before
LPG emits any user defined actions.<span style='mso-spacerun:yes'> 
</span>After all actions have been emitted, LPG emits the template’s “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$Trailers</span></b></span>”
section.<span style='mso-spacerun:yes'>  </span>This section has the macro <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$EndActions</span></b></span>
which completes the ruleAction method.<span style='mso-spacerun:yes'> 
</span>The trailers section also completes the action class declaration with a
closing brace.<span style='mso-spacerun:yes'>  </span>The <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>$EndActions</span></b></span>
method is defined as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>$EndActions</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>/.</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>default:</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                    </span>break;</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'>         </span>return;</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>}./</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The rules and trailers sections in the template are as
follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$Rules</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>/.$BeginActions./</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$End</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$Trailers</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>/.</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>$EndActions</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>./</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$End</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Finally the actions themselves use two macros: <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$BeginAction</span></b> and
<span class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:
10.0pt'>$EndAction</span></b></span>.<span style='mso-spacerun:yes'> 
</span>These are defined as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>$DefaultAction</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>/. $Header</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>case $rule_number: { ./</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>$BeginAction /.$DefaultAction./</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>$EndAction</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>/.<span style='mso-spacerun:yes'>         
</span>break;</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>}./</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:10.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>$DefaultAction macro</span></b></span> specifies a new
case alternative.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h3>The Parser</h3>

<p class=MsoNormal>The parser, as noted above, is specified by the following
grammar file:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>%options
ast_directory=./ExprAst,automatic_ast=toplevel,var=nt,visitor=default</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options programming_language=java</span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options package=expr1</span></b><b style='mso-bidi-font-weight:normal'><span
lang=FR style='font-size:9.0pt;font-family:"Courier New";mso-ansi-language:
FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options template=dtParserTemplateD.g</span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>%options import_terminals=ExprLexer.g</span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:9.0pt;font-family:"Courier New";
mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$Terminals</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><span style='mso-spacerun:yes'>    </span></span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'>IntegerLiteral</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>PLUS ::= +</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>MULTIPLY ::= *</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>LPAREN ::= (</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>RPAREN ::= )</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$end</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$Rules</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span></span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:9.0pt;font-family:"Courier New";
background:white;mso-highlight:white;mso-ansi-language:FR'>E ::= E + T</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>        </span>| T</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>    </span>T ::= T * F</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>        </span>| F</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>    </span>F ::= IntegerLiteral</span></b><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";mso-ansi-language:FR'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span lang=FR style='font-size:9.0pt;
font-family:"Courier New";background:white;mso-highlight:white;mso-ansi-language:
FR'><span style='mso-spacerun:yes'>    </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New";background:white;
mso-highlight:white'>F$ParenExpr ::= ( E )</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$End</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The parser imports its terminal symbols from the lexer
grammar file,<span style='mso-spacerun:yes'>  </span>In fact, when LPG compiles
this parser grammar file, it<span style='mso-spacerun:yes'>  </span>also
compiles the imported lexer grammar file.<span style='mso-spacerun:yes'> 
</span>It is not necessary to import symbols from the lexer.<span
style='mso-spacerun:yes'>  </span>Often the same lexer will be used by several
different parsers, so having only one instance of the lexer is
advantageous.<span style='mso-spacerun:yes'>  </span>If terminal symbols are
not imported, then it is necessary to have a “terminals” section.<span
style='mso-spacerun:yes'>  </span>In our example the terminal symbol section is
redundant and can be omitted.<span style='mso-spacerun:yes'>  </span>We do not
have a “start” section, so the first left-hand side symbol, <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>E</span></b></span>,
is by default the start symbol.<span style='mso-spacerun:yes'>  </span>The AST
is automatically generated so have no need to write actions (but we will
examine the actions LPG generates).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The Parser Template</h5>

<p class=MsoNormal>The template used here is the “deterministic” parsing template,
<span class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:
10.0pt'>dtParserTemplateD</span></b></span>.<span style='mso-spacerun:yes'> 
</span>The LPG runtime has a traditional “deterministic” LALR parser, and a
“backtracking” parser.<span style='mso-spacerun:yes'>  </span>The deterministic
parser supports any amount of look-ahead, the amount of which is specified by
the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>look_ahead</span></b></span>” option (the default is
1), while the backtracking parser uses only one token look-ahead but can
backtrack on errors and pursue alternative parsing.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>The Action Class</h6>

<p class=MsoNormal>The deterministic parser template specifies the action class
in much the same way as the lexer template does.<span
style='mso-spacerun:yes'>  </span>Here is the start of the action class
declaration (the declaration order has been changed to simplify our
explanation):</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>public class $action_type extends PrsStream
<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'>   </span>implements
RuleAction$additional_interfaces</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>private static ParseTable prs = new
$prs_type();</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>private DeterministicParser dtParser;</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'>        </span><b style='mso-bidi-font-weight:
normal'>public String[] orderedTerminalSymbols() <o:p></o:p></b></span></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return
$sym_type.orderedTerminalSymbols; }</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public $action_type(LexStream
lexStream)</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>super(lexStream);</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>try</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>super.remapTerminalSymbols(<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>orderedTerminalSymbols(),$prs_type.EOFT_SYMBOL);</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>catch(NullExportedSymbolsException
e) {</span></b><b style='mso-bidi-font-weight:normal'><span style='font-size:
9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>catch(NullTerminalSymbolsException
e) {</span></b><b style='mso-bidi-font-weight:normal'><span style='font-size:
9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>           
</span>catch(UnimplementedTerminalsException e)</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>java.util.ArrayList
unimplemented_symbols = e.getSymbols();</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>System.out.println<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>(&quot;The Lexer will not scan the following token(s):&quot;);</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>for (int i = 0; i &lt;
unimplemented_symbols.size(); i++)</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>{</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                    </span>Integer id = (Integer)
unimplemented_symbols.get(i);</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                    </span>System.out.println<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>(&quot;<span style='mso-spacerun:yes'>    </span>&quot; +
$sym_type.orderedTerminalSymbols[id.intValue()]);<span
style='mso-spacerun:yes'>               </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>}</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>System.out.println();<span
style='mso-spacerun:yes'>                        </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>catch(UndefinedEofSymbolException
e)</span></b><b style='mso-bidi-font-weight:normal'><span style='font-size:
9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>             </span><span
style='mso-spacerun:yes'>   </span>throw new Error(new
UndefinedEofSymbolException</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                  </span>(&quot;The Lexer does not
implement the Eof symbol &quot; +</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'>     
</span>$sym_type.orderedTerminalSymbols[$prs_type.EOFT_SYMBOL]));</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>} </span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Notice that the action class is named by the macro, <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>$action_type</span></b>,
which is by default the file prefix (<b style='mso-bidi-font-weight:normal'><span
lang=FR style='font-size:10.0pt;font-family:"Courier New";background:white;
mso-highlight:white;mso-ansi-language:FR'>Expr</span></b><b style='mso-bidi-font-weight:
normal'><span lang=FR style='font-size:10.0pt;font-family:"Courier New";
mso-ansi-language:FR'>Parser</span></b> in our case).<span
style='mso-spacerun:yes'>  </span>The action class extends <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>PrsStream</span></b> and implements the <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>RuleAction</span></b>
interface (just as we saw above with the lexer).<span
style='mso-spacerun:yes'>  </span>There may be additional interfaces
implemented by methods the user defines so the template provides a macro for
specifying them.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>A parse table instance (of the class defined in the “prs”
file) is declared using the macro <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>$prs_type</span></b>, so that the tables need only be loaded once even
the parse method (shown below) is called many times.<span
style='mso-spacerun:yes'>  </span>A private variable references the runtime
deterministic parser. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>There is one constructor for the class and it takes a <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>LexStream</span></b></span>,<span
style='mso-spacerun:yes'>  </span>as its argument.<span
style='mso-spacerun:yes'>  </span>As noted above in our discussion of the main
program, the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>LexStream</span></b></span> will be the lexer
itself.<span style='mso-spacerun:yes'>  </span>The action class extends <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>PrsStream</span></b> whose constructor
is called to link the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>LexStream</span></b></span> and <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>
together.<span style='mso-spacerun:yes'>  </span>The constructor then checks
the validity of the <span style='mso-spacerun:yes'> </span>terminal symbol file
(given by the macro <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>$sym_type</span></b>) and remaps the terminal symbol values assigned by
the lexer to the values defined in the parser’s symbol file.<span
style='mso-spacerun:yes'>  </span>In this way the parser will always use the
correct symbol value, even when the lexer is independently constructed.<span
style='mso-spacerun:yes'>  </span>It is possible that the parser has some
terminal symbols that are not exported by the lexer and thus will never become
tokens.<span style='mso-spacerun:yes'>  </span>This is not an error.<span
style='mso-spacerun:yes'>  </span>The parser continues, though an exception is
thrown and the symbols that cannot be scanned are listed on the console.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>The Parser Method</h6>

<p class=MsoNormal>Next we consider the “parser” methods.<span
style='mso-spacerun:yes'>  </span>There is essentially one method but four
different ways to invoke it:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public $ast_class parser()</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{ return parser(null, 0); }</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public $ast_class parser(Monitor
monitor)</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{ return parser(monitor, 0); }</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'>          </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public $ast_class parser(int
error_repair_count)</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{ return parser(null,
error_repair_count); }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public $ast_class parser(Monitor
monitor, int error_repair_count)</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>try</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{ <span
style='mso-spacerun:yes'>  </span>dtParser = new DeterministicParser<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.5in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>(monitor, (TokenStream)this, prs, (RuleAction)this);</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>catch
(NotDeterministicParseTableException e)</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{ <span
style='mso-spacerun:yes'>  </span>throw new Error(new
NotDeterministicParseTableException</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>    </span><span
style='mso-spacerun:yes'>                   </span>(&quot;Regenerate
$prs_type.java with -NOBACKTRACK option&quot;));</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>catch (BadParseSymFileException e)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{ <span
style='mso-spacerun:yes'>  </span>throw new Error(new BadParseSymFileException<o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>(&quot;Bad Parser Symbol File&quot; + <o:p></o:p></span></b></p>

<p class=MsoNormal style='margin-left:1.0in;text-indent:.5in;mso-layout-grid-align:
none;text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>&quot; -- $sym_type.java.
Regenerate $prs_type.java&quot;));</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'>   </span><span
style='mso-spacerun:yes'>         </span>}</span><span style='font-size:9.0pt;
font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>try</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{ <span
style='mso-spacerun:yes'>  </span>return ($ast_class) dtParser.parse(); }</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>catch (BadParseException e)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>{ <span
style='mso-spacerun:yes'>  </span>reset(e.error_token); // point to error token</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>                </span>DiagnoseParser diagnoseParser =
new DiagnoseParser(this, prs);</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>               
</span>diagnoseParser.diagnose(e.error_token);</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>return null;</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'>}<o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public DeterministicParser getParser()
{ return dtParser; }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><span style='font-size:9.0pt'><span
style='mso-spacerun:yes'> </span><o:p></o:p></span></p>

<p class=MsoNormal>The parser takes as arguments a “monitor” and an
“error_repair_count”.<span style='mso-spacerun:yes'>   </span>The monitor gives
you the ability to limit parser execution time.<span style='mso-spacerun:yes'> 
</span><span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>Monitor</span></b></span> is actually an interface in
the LPG Java runtime with a single Boolean method <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>isCancelled</span></b></span>,
which the user may implement. <span style='mso-spacerun:yes'> </span>It is not further
discussed in this document.<span style='mso-spacerun:yes'>  </span>No monitor
is specified by a “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>null</span></b></span>” argument.<span
style='mso-spacerun:yes'>  </span>The error count argument is used with “error
productions”. <span style='mso-spacerun:yes'> </span>These allow the parser to skip
over specified syntactic constructs, for example “statement”, that contain
errors without terminating the parse.<span style='mso-spacerun:yes'> 
</span>The error count indicates how many times an erroneous construct may be
skipped.<span style='mso-spacerun:yes'>  </span>At the present time the use of
error productions is only supported by the backtracking parser (though it may
be added to the deterministic parser in the future) and so this argument is simply
ignored. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The body of the parser method creates a <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>DeterministicParser</span></b> giving it the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>monitor</span></b></span>,<span
style='mso-spacerun:yes'>  </span>the <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>TokenStream</span></b>, which is “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>this</span></b></span>” instance of the
action class (a subclass of <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>PrsStream</span></b></span>), the <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>ParseTable</span></b>, <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>prs</span></b></span>,
and “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>this</span></b></span>” as an instance of a class
implementing the <b style='mso-bidi-font-weight:normal'><span style='font-size:
10.0pt;font-family:"Courier New";background:white;mso-highlight:white'>RuleAction</span></b>
interface.<span style='mso-spacerun:yes'>  </span>The parser checks that the
parse tables are tables for a deterministic (not backtracking) parser and that
the symbol file is valid.<span style='mso-spacerun:yes'>  </span>When LPG
compiles a lexer that exports tokens, an export symbol file is generated.<span
style='mso-spacerun:yes'>  </span>LPG always generates a symbol file for the
parser’s terminal symbols.<span style='mso-spacerun:yes'>  </span>If these
files are shared (that is, are the same file), then if the lexer is compiled
after the parser has been compiled (to fix a lexer bug, say), the symbol file is
no longer be valid and the <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>BadParseSymFileException</span></b> will be thrown.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Finally the deterministic parser’s <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>parse</span></b> method is called.<span
style='mso-spacerun:yes'>  </span>Should a syntax error occur, the <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>BadParseException</span></b>
exception is thrown and the diagnosing parser is called to find all syntax
errors in the input token list.<span style='mso-spacerun:yes'>  </span>If there
is an error, no syntactic actions are executed and hence no AST can be
generated.<span style='mso-spacerun:yes'>  </span>Essentially the parser stops
on the first error.<span style='mso-spacerun:yes'>  </span>If one prefers not
to diagnose all errors, the template can be modified to take some other action,
such as printing out the error token and quitting.</p>

<h6>Token Access and Location Methods</h6>

<p class=MsoNormal>The template defines several methods for accessing and
locating tokens.<span style='mso-spacerun:yes'>  </span>These methods are used
in the syntactic actions.<span style='mso-spacerun:yes'>  </span>Recall that
the<span style='mso-spacerun:yes'>  </span>LPG Java runtime contains a <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Token</span></b></span>
class and an <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IToken</span></b></span> interface.<span
style='mso-spacerun:yes'>  </span>A token has a “kind” (a number LPG assigns to
identify the token to the parser),<span style='mso-spacerun:yes'>  </span>start
and end offsets (beginning and ending indexes of the token in the input character
array), the index of the token in the token array list and an “adjunct” array
index (while scanning tokens, comments or other text associated with a token
may be placed in a token like array – there is a method, <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>makeAdjunct</span></b></span>,
in <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>PrsStream</span></b></span> to construct the adjunct).<span
style='mso-spacerun:yes'>  </span>There are methods in the <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Token</span></b></span>
class for obtaining this location information.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>These are the methods provided in the template:<o:p></o:p></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span></span><span style='font-size:
9.0pt;font-family:"Courier New"'><o:p></o:p></span></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>private void setResult(Object object) {
dtParser.setSym1(object); }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>  </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>      </span><span style='mso-spacerun:yes'>  </span>public
Object getRhsSym(int i) { return dtParser.getSym(i); }</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public int getRhsTokenIndex(int i) {
return dtParser.getToken(i); }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public IToken getRhsIToken(int i) <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return
super.getIToken(getRhsTokenIndex(i)); }</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span></span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public int getRhsFirstTokenIndex(int i)
<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return
dtParser.getFirstToken(i); }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>public IToken
getRhsFirstIToken(int i) <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return
super.getIToken(getRhsFirstTokenIndex(i)); }</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public int getRhsLastTokenIndex(int i) <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return
dtParser.getLastToken(i); }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public IToken getRhsLastIToken(int i) <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return super.getIToken(getRhsLastTokenIndex(i));
}</span></b><b style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;
font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public int getLeftSpan() { return
dtParser.getFirstToken(); }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>       </span><span
style='mso-spacerun:yes'> </span>public IToken getLeftIToken(){ return
super.getIToken(getLeftSpan()); }</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public int getRightSpan() { return
dtParser.getLastToken(); }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public IToken getRightIToken() <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return
super.getIToken(getRightSpan()); }</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>The first method, <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New";background:white;mso-highlight:
white'>setResult</span></b> is used to place the result of the rule action on
the runtime parser’s “symbol” stack to represent the value of the left-hand
side symbol.<span style='mso-spacerun:yes'>  </span>This result is then
available when a rule with this symbol on its right-hand side is subsequently
reduced and can be accessed using the method <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New";background:
white;mso-highlight:white'>getRhsSym</span></b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>For example, here is what is generated for some of the rules
of our expression grammar:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span>//
Rule 3:<span style='mso-spacerun:yes'>  </span>T ::= T * F<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span>case
3: {<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               
</span>setResult(<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>                   
</span>new T(getLeftIToken(), getRightIToken(),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span
style='mso-spacerun:yes'>                          </span>(IT)getRhsSym(1),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span
style='mso-spacerun:yes'>                          </span>(IF)getRhsSym(3))<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               
</span>);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               
</span>break;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span><span
style='mso-spacerun:yes'>        </span>} <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span>//
Rule 5:<span style='mso-spacerun:yes'>  </span>F ::= IntegerLiteral<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span>case
5: {<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               
</span>setResult(new F(getRhsIToken(1)));<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               
</span>break;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>            </span>}<o:p></o:p></span></b></p>

<p class=MsoNormal>For rule 5 the result is a new instance of the class <b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt'>F.</span></b><span
style='mso-spacerun:yes'>  </span>In rule 3, <b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt'>F</span></b> is the third right-hand side
symbol and the action for this rule accesses its value with the call <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'>getRhsSym(3)</span></b>.<span style='mso-spacerun:yes'> 
</span>The action for rule 3 creates an instance of <b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt'>T</span></b> as its result.<span
style='mso-spacerun:yes'>  </span>The method calls, <b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'>getLeftIToken()</span></b>and
<b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;
font-family:"Courier New"'>getRightIToken()</span></b>, passed to the
constructor in rule 3, retrieve the starting input character array index of the
leftmost token and the ending index of the rightmost token spanned by the
rule.<span style='mso-spacerun:yes'>  </span>These two operations are normally
sufficient to obtain location information.<span style='mso-spacerun:yes'> 
</span>Sometimes the right-hand side is a token, as in rule 5.<span
style='mso-spacerun:yes'>  </span>In this case the generated AST passes to the
rule class constructor the actual token itself using the method <b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'>getRhsIToken</span></b>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>Miscellaneous Methods</h6>

<p class=MsoNormal>There are a few additional useful methods defined in the
action class.<span style='mso-spacerun:yes'>  </span>There are methods to
access the “error token” (which the user may choose to define), a method to get
the grammar specified token name (e.g., <b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>IntegerLiteral</span></b>,
in our example) and a method to get the<span style='font-size:10.0pt'> </span><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New";background:white;mso-highlight:white'>PrsStream</span></b>
Instance.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public int getRhsErrorTokenIndex(int i)</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>         </span><span
style='mso-spacerun:yes'>   </span>int index = dtParser.getToken(i);</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>IToken err =
super.getIToken(index);</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>return (err instanceof ErrorToken ?
index : 0);</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public ErrorToken getRhsErrorIToken(int
i)</span></b><b style='mso-bidi-font-weight:normal'><span style='font-size:
9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>{</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>int index = dtParser.getToken(i);</span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>IToken err =
super.getIToken(index);</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>            </span>return (ErrorToken) (err instanceof
ErrorToken ? err : null);</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>}</span></b><b style='mso-bidi-font-weight:
normal'><span style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public String getTokenKindName(int
kind) <o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'> </span>{ return
$sym_type.orderedTerminalSymbols[kind]; }<o:p></o:p></span></b></p>

<p class=MsoNormal style='text-indent:.5in;mso-layout-grid-align:none;
text-autospace:none'><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New";background:white;mso-highlight:
white'><span style='mso-spacerun:yes'>          </span></span></b><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'>      </span>public int getEOFTokenKind() { return
$prs_type.EOFT_SYMBOL; }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New"'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal style='mso-layout-grid-align:none;text-autospace:none'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt;font-family:
"Courier New";background:white;mso-highlight:white'><span
style='mso-spacerun:yes'>        </span>public PrsStream getParseStream() {
return (PrsStream) this; }</span></b><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt;font-family:"Courier New"'><o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The Generated AST</h5>

<p class=MsoNormal>For our expression example we let LPG generate the AST.<span
style='mso-spacerun:yes'>  </span>This AST consists of classes representing the
grammar rules and interfaces (or types) for the non-terminal symbols.<span
style='mso-spacerun:yes'>  </span>For most rule reductions LPG constructs an
instance of the rule class passing it right-hand side symbol values.<span
style='mso-spacerun:yes'>  </span>A rule class extends one of three AST base
classes and implements an interface determined by the left-hand side of the
rule.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Two of the AST base classes are relevant to our example: <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Ast</span></b></span>
and <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>AstToken</span></b></span>.<span
style='mso-spacerun:yes'>  </span>Rules with more than one symbol on the
right-hand side generate a rule class that extends <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Ast</span></b></span>.<span
style='mso-spacerun:yes'>  </span>Rules having a single terminal symbol as
their right-hand side generate a rule class that extends <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>AstToken</span></b></span>.<span
style='mso-spacerun:yes'>  </span>Rules having a single non-terminal symbol as
their right-hand side do not generate a rule class (however, the interface
defined for their right-hand side symbol extends the interface defined for
their left-hand side). </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>The Ast Class</h6>

<p class=MsoNormal>Here is most of the <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>Ast</span></b></span> class (methods to
get adjuncts and test for equality are omitted):</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public abstract class Ast<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>protected
IToken leftIToken,<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>                    
</span>rightIToken;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IToken
getLeftIToken() { return leftIToken; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IToken
getRightIToken() { return rightIToken; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public String
toString()<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>PrsStream
prsStream = leftIToken.getPrsStream();<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>return
new String(<o:p></o:p></span></b></p>

<p class=MsoPlainText style='margin-left:.5in;text-indent:.5in'><b
style='mso-bidi-font-weight:normal'><span style='font-size:9.0pt'>prsStream.getInputChars(),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>             </span>leftIToken.getStartOffset(),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>             </span>rightIToken.getEndOffset()
- leftIToken.getStartOffset() + 1);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
Ast(IToken token) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{
this.leftIToken = this.rightIToken = token; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
Ast(IToken leftIToken, IToken rightIToken)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<span
style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'> </span>this.leftIToken = leftIToken;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>this.rightIToken = rightIToken;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>void
initialize() {}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
abstract void accept(Visitor v);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
abstract void accept(ArgumentVisitor v, Object o);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
abstract Object accept(ResultVisitor v);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
abstract Object accept(ResultArgumentVisitor v, Object o);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>The attributes of the <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>Ast</span></b></span> class are left and
right tokens.<span style='mso-spacerun:yes'>  </span>The constructor for a
specific rule class passes to the <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>Ast</span></b></span> class constructor
the left and right tokens spanned by its rule.<span style='mso-spacerun:yes'> 
</span>The string of characters comprising this span can be obtained using the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>toString</span></b></span>
method.<span style='mso-spacerun:yes'>  </span>There is an <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>initialize</span></b></span>
method which can be overwritten for a specific rule class by the user (we
explain how this works in another document).<span style='mso-spacerun:yes'> 
</span>Finally, there are four abstract methods for accepting a “visitor” to
process rule class instances.<span style='mso-spacerun:yes'>  </span>This will
be explained in more detail below where we discuss walking the AST.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>The AstToken Class and Interface</h6>

<p class=MsoNormal>The <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>AstToken</span></b></span> class is more like a rule
class that focuses on tokens:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public class AstToken extends Ast implements IAstToken<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
AstToken(IToken token) { super(token); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IToken
getIToken() { return leftIToken; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public String
toString() { return leftIToken.toString(); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'>  </span>public void accept(Visitor v) {
v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
accept(ArgumentVisitor v, Object o) { v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultVisitor v) { return v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultArgumentVisitor v, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>  </span><span
style='mso-spacerun:yes'>  </span>{ return v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>Notice that this class extends <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Ast</span></b></span>,
as does a rule class, and implements <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>IAstToken</span></b></span>, just as a
rule class implements an interface for its left-hand side.<span
style='mso-spacerun:yes'>  </span>Terminal symbols (or tokens) have the same
“type” or interface while non-terminal symbols generally have different
types.<span style='mso-spacerun:yes'>  </span>The method <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>getIToken</span></b></span>
retrieves the token and the <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>toString</span></b></span> method gives
its textual content.<span style='mso-spacerun:yes'>  </span>As required by the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IAstToken</span></b></span>
interface this class implements <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>accept</span></b></span> methods for the
four kinds of visitor.<span style='mso-spacerun:yes'>  </span>The <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IAstToken</span></b></span>
interface also requires implementation of getters for left and right tokens (to
be compatible with non-terminal symbol interfaces) and is defined as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public interface IAstToken<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IToken
getLeftIToken();<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IToken
getRightIToken();<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>void
accept(Visitor v);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>void
accept(ArgumentVisitor v, Object o);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>Object
accept(ResultVisitor v);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>Object
accept(ResultArgumentVisitor v, Object o);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<h6>The Rule Classes and Interfaces</h6>

<p class=MsoNormal>Now let us examine the classes and interfaces for the rules
in our grammar.<span style='mso-spacerun:yes'>  </span>Consider first the rules
with left-hand side symbol <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>F</span></b></span>.<span
style='mso-spacerun:yes'>  </span>The first rule produces an integer literal
while the second produces a parenthesized expression.<span
style='mso-spacerun:yes'>  </span>The <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>F</span></b></span> interface, <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IF</span></b></span>,
is simply:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public interface IF extends IT, IAstToken {}<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The first rule is the reason <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>
extends <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IAstToken</span></b></span>, while the rule, <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>T
::= F</span></b></span>, requires that <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>F</span></b></span> extend <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IT</span></b></span>.<span
style='mso-spacerun:yes'>  </span>The class for the first rule, “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F
::= IntegerLiteral</span></b></span>”, is (essentially) as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public class F extends AstToken implements IF<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
F(IToken token) { super(token); initialize(); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
accept(Visitor v) { v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
accept(ArgumentVisitor v, Object o) { v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultVisitor v) { return v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultArgumentVisitor v, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>For this rule LPG generates the action code, “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>setResult(new
F(getRhsIToken(1)));</span></b></span>”.</p>

<p class=MsoNormal>As noted above, this creates an instance of <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>
which is in fact an <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>AstToken</span></b></span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The class for the second rule with left-hand side <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>,
“<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>F$ParenExpr ::= ( E )</span></b></span>”, is named <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ParenExpr</span></b></span>
and is defined as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public class ParenExpr extends Ast implements IF<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>private IE
_E;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IE
getE() { return _E; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
ParenExpr(IToken leftIToken, IToken rightIToken, IE _E)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<span
style='mso-spacerun:yes'>   </span>super(leftIToken, rightIToken);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>this._E =
_E;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>initialize();<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
accept(Visitor v) { v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
accept(ArgumentVisitor v, Object o) { v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultVisitor v) { return v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultArgumentVisitor v, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>This class has a single attribute, “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>_E</span></b></span>”,<span
style='mso-spacerun:yes'>  </span>and a method to access it, “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>getE()</span></b></span>”.<span
style='mso-spacerun:yes'>  </span>Notice that an instance of this attribute may
be an <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>E</span></b></span>, a <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>T</span></b></span>
or an <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>F</span></b></span>, which is why the <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IT</span></b></span>
and <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IF</span></b></span> interfaces extend <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IE</span></b></span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>LPG generates the following action code:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>setResult(new ParenExpr(getLeftIToken(),
getRightIToken(),(IE)getRhsSym(2)));<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>The left parenthesis is the left token and the right
parentheses is the right token.<span style='mso-spacerun:yes'>  </span>For the
second right-hand side symbol, “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>E</span></b></span>”, previous
reductions have stacked an object of type “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IE</span></b></span>”
belonging to one of the classes <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>E</span></b></span>, <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>T</span></b></span>,
<span class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:
10.0pt'>F</span></b></span>, or <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>ParenExpr</span></b></span>. </p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The only remaining rules of interest are “<b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;font-family:
"Courier New"'>E ::= E + T</span></b>” and “<b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'>T ::= T * F</span></b>”.<span
style='mso-spacerun:yes'>  </span>The single productions “<b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt;font-family:"Courier New"'>E ::= T</span></b>”
and “<b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt;
font-family:"Courier New"'>T ::= F</span></b>” do not generate rule classes or
actions but serve only to indicate subtypes of the expression type.<span
style='mso-spacerun:yes'>  </span>Since these two rules are very much alike we
will only consider the rule “<b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt;font-family:"Courier New"'>E ::= E + T</span></b>”.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IE</span></b></span> interface is essentially the same
as the <b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IAstToken</span></b>
interface shown above -- only the name is different.<span
style='mso-spacerun:yes'>  </span>Interfaces provide strong typing for the rule
class attributes.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>E</span></b></span>” rule class is as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public class E extends Ast implements IE<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>private IE
_E;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>private IT
_T;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IE
getE() { return _E; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public IT
getT() { return _T; }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
E(IToken leftIToken, IToken rightIToken, IE _E, IT _T)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<span
style='mso-spacerun:yes'>   </span>super(leftIToken, rightIToken);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>this._E =
_E;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>this._T =
_T;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>initialize();<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
accept(Visitor v) { v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public void
accept(ArgumentVisitor v, Object o) { v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultVisitor v) { return v.visit(this); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
accept(ResultArgumentVisitor v, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
v.visit(this, o); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>This class has two attributes (for the expression and the
term) and getters for them.<span style='mso-spacerun:yes'>  </span>The
constructor is essentially the same as the one for parenthesized expression shown
above.<span style='mso-spacerun:yes'>  </span>As with all rule classes there
are methods to accept visitors.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The LPG generated action for this rule should not surprise
us.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>setResult(new E(getLeftIToken(), getRightIToken(),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>          </span><span
style='mso-spacerun:yes'>      </span>(IE)getRhsSym(1),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>                </span>(IT)getRhsSym(3))<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               </span>);<o:p></o:p></span></b></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>Notice that the constructor is passed the token span of the
rule and the expression and term instances that are to be added together.<span
style='mso-spacerun:yes'>  </span>The plus operator is ignored since we have
taken the option “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>var=nt</span></b></span>”, which means that LPG should
generate variables only for non-terminal symbols.<span
style='mso-spacerun:yes'>  </span>If we wanted the operator token as an
attribute of our class, then all we need to do is suffix the terminal symbol
with a name (prefixed with a dollar sign).</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h5>The AST Visitor</h5>

<p class=MsoNormal>The generated AST is a simplified syntax derivation tree.<span
style='mso-spacerun:yes'>  </span>A tree node is an instance of a rule class
and its children are its attributes that are rule instances or token
instances.<span style='mso-spacerun:yes'>  </span>For example, given the input
“<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>3 + 4 * 2</span></b></span>”<span
style='mso-spacerun:yes'>  </span>we can visually display its AST as “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>E[F[3],
T[F[4], F[2]]]</span></b></span>”.<span style='mso-spacerun:yes'>  </span>The “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>E</span></b></span>”
node has two children, an “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>F</span></b></span>” and a “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>T</span></b></span>”
; the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>T</span></b></span>” has two “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>”
children and the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>F</span></b></span>” nodes always have an integer
literal child.<span style='mso-spacerun:yes'>   </span>(Please forgive the
linear representation which encloses the children of a node in square
brackets.)<span style='mso-spacerun:yes'>  </span>To process this tree we need
to traverse the nodes and operate on their attributes.<span
style='mso-spacerun:yes'>  </span>LPG supports the “visitor” paradigm for
processing the AST.<span style='mso-spacerun:yes'>  </span>The classes and
methods making up the visitor are completely independent of the AST.<span
style='mso-spacerun:yes'>  </span>The visitor accesses the AST through node
attribute methods and the AST communicates with the visitor through its accept
methods.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>The Generated Visitor Interfaces</h6>

<p class=MsoNormal>LPG generates four visitor interfaces: <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Visitor</span></b></span>,
<span class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:
10.0pt'>ArgumentVisitor</span></b></span>, <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ResultVisitor</span></b></span>
and <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>ResultArgumentVisitor</span></b></span>.<span
style='mso-spacerun:yes'>  </span>The simplest is the <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Visitor</span></b></span>
interface, which for our example is as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>public interface
Visitor<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>{<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>void visit(AstToken n);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>void visit(E n);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>void visit(T n);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>void visit(F n);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='mso-spacerun:yes'>    </span>void visit(ParenExpr n);<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>}<o:p></o:p></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>The “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>visit</span></b></span>” method is overloaded by an
argument for each AST class that is used.<span style='mso-spacerun:yes'> 
</span>Each AST class has an “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>accept</span></b></span>” method that
invokes the corresponding visit method passing it “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>this</span></b></span>”
instance as argument, as we have seen above:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>public void
accept(Visitor v) { v.visit(this); }<o:p></o:p></b></p>

<p class=MsoNormal><b style='mso-bidi-font-weight:normal'><o:p>&nbsp;</o:p></b></p>

<p class=MsoNormal>Thus, while visiting one node, say “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>m</span></b></span>”
, should we want to visit a child node, say “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>n</span></b></span>”,
we simply tell the child to “accept” the visitor – “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>n.accept(v)</span></b></span>”.
</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>ArgumentVisitor</span></b></span> “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>visit</span></b></span>”
methods take an additional argument (an “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>Object</span></b></span>”), which can be
used for inherited attributes, while those of the <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ResultVisitor</span></b></span>
produce a result, which can be used for synthesized attributes.<span
style='mso-spacerun:yes'>  </span>The <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>ResultArgumentVisitor</span></b></span>
methods both take an argument and return a result.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>The Generated Visitor Classes </h6>

<p class=MsoNormal>In addition to the visitor interfaces, LPG generates two abstract
visitor classes: the<span style='mso-spacerun:yes'>  </span><span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>AbstractVisitor</span></b></span>
class that implements the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>Visitor</span></b></span> and <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ArgumentVisitor</span></b></span>
interfaces and the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>AbstractResultVisitor</span></b></span> class that
implements the <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>ResultVisitor</span></b></span> and <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>ResultArgumentVisitor</span></b></span>
interfaces.</p>

<p class=MsoNormal>Here is the <span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>AbstractVisitor</span></b></span> class
generated for our example:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public abstract class AbstractResultVisitor <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>                </span>implements
ResultVisitor, ResultArgumentVisitor<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public
abstract Object unimplementedVisitor(String s);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(AstToken n) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
unimplementedVisitor(&quot;visit(AstToken)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(AstToken n, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return<span
style='mso-spacerun:yes'>  </span>unimplementedVisitor(&quot;visit(AstToken,
Object)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(E n) { return unimplementedVisitor(&quot;visit(E)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(E n, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return<span
style='mso-spacerun:yes'>  </span>unimplementedVisitor(&quot;visit(E,
Object)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(T n) { return unimplementedVisitor(&quot;visit(T)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(T n, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return<span
style='mso-spacerun:yes'>  </span>unimplementedVisitor(&quot;visit(T,
Object)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(F n) { return unimplementedVisitor(&quot;visit(F)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(F n, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return<span
style='mso-spacerun:yes'>  </span>unimplementedVisitor(&quot;visit(F,
Object)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(ParenExpr n) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return
unimplementedVisitor(&quot;visit(ParenExpr)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(ParenExpr n, Object o) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{ return<span
style='mso-spacerun:yes'>  </span>unimplementedVisitor(&quot;visit(ParenExpr,
Object)&quot;); }<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>A visitor that extends this abstract class must implement
the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>unimplementedVisitor</span></b></span>” abstract
method.<span style='mso-spacerun:yes'>  </span>One implementation might simply
be to ignore an unimplemented visit to a node.<span style='mso-spacerun:yes'> 
</span>It might be better to provide a message or throw an exception when such
a visitor is invoked.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h6>The Expression Visitor </h6>

<p class=MsoNormal>For our expression example we have implemented a result
visitor which we call “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>ExprResultVisitor</span></b></span>”.<span
style='mso-spacerun:yes'>  </span>The purpose of the visitor is to “walk” the AST
and evaluate the terms and expressions it contains.<span
style='mso-spacerun:yes'>  </span></p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>In the main program the AST node returned from the parser
accepts our visitor which evaluates the input expression.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'>Integer result =
(Integer) ast.accept(new ExprResultVisitor());<o:p></o:p></b></p>

<p class=MsoPlainText><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The visitor class is as follows:</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>public class ExprResultVisitor extends
AbstractResultVisitor<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
unimplementedVisitor(String s) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>       
</span>System.out.println(s);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>return
null;<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(E expr) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>Integer
left = (Integer) expr.getE().accept(this),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               
</span>right = (Integer) expr.getT().accept(this);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>return
new Integer(left.intValue() + right.intValue());<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(T expr) <o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>Integer
left = (Integer) expr.getT().accept(this),<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>               
</span>right = (Integer) expr.getF().accept(this);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>return
new Integer(left.intValue() * right.intValue());<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(F expr)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>return
new Integer(expr.toString());<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>public Object
visit(ParenExpr expr)<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>{<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>        </span>return
(Integer) expr.getE().accept(this);<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><span style='mso-spacerun:yes'>    </span>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'>}<o:p></o:p></span></b></p>

<p class=MsoPlainText><b style='mso-bidi-font-weight:normal'><span
style='font-size:9.0pt'><o:p>&nbsp;</o:p></span></b></p>

<p class=MsoNormal>To understand how this visitor works, let us follow its
execution on the sample tree, “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>E[F[3], T[F[4], F[2]]]</span></b></span>”,
shown above.<span style='mso-spacerun:yes'>  </span>The top node “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>E</span></b></span>”,
which is visited by the accept call in the main program, has two children: an “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>”
node and a “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>T</span></b></span>” node.<span
style='mso-spacerun:yes'>  </span>The “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>E</span></b></span>” accept method calls
the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>visit(E expr)</span></b></span>” method of our
visitor.<span style='mso-spacerun:yes'>  </span>This method retrieves the “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IE</span></b></span>”
and the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IT</span></b></span>” attributes, visits them in turn
and adds the resulting values.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IE</span></b></span>” attribute is actually an “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>”
instance so it is the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>visit(F expr)</span></b></span>” method that evaluates
the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IE</span></b></span>” child.<span
style='mso-spacerun:yes'>  </span>The visitor converts the token text of “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>”
to an <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>Integer</span></b></span> object.<span
style='mso-spacerun:yes'>  </span>Thus, an <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Integer(3)</span></b></span>
is returned.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<p class=MsoNormal>The “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IT</span></b></span>” attribute is a “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>T</span></b></span>”
instance, so the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>visit(T expr)</span></b></span>” method is invoked to
visit it.<span style='mso-spacerun:yes'>  </span>This method is quite similar
to the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>visit(E expr)</span></b></span>” method, but the
attributes are of type “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>IT</span></b></span>” and “<span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>IF</span></b></span>”,
respectively, and the operation is multiplication.<span
style='mso-spacerun:yes'>  </span>The “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>IT</span></b></span>” attribute is an “<span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>F</span></b></span>”
instance which will be visited (as we saw above) and produce the value <span
class=Char><b style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Integer(4)</span></b></span>.<span
style='mso-spacerun:yes'>  </span>The “<span class=Char><b style='mso-bidi-font-weight:
normal'><span style='font-size:10.0pt'>IF</span></b></span>” attribute is also
an “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>F</span></b></span>” instance and when visited
produces the value <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>Integer(2)</span></b></span>.<span
style='mso-spacerun:yes'>  </span>These two values are multiplied together to
obtain an <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>Integer(8) </span></b></span>value.<span
style='mso-spacerun:yes'>  </span>This is added to the <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Integer(3)</span></b></span>
value of the “<span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>F</span></b></span>” instance to obtain the main
program <span class=Char><b style='mso-bidi-font-weight:normal'><span
style='font-size:10.0pt'>result</span></b></span>, <span class=Char><b
style='mso-bidi-font-weight:normal'><span style='font-size:10.0pt'>Integer(11)</span></b></span>.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

<h2>Conclusion</h2>

<p class=MsoNormal>We have illustrated the use of LPG for syntactical and
lexical analysis through a simple expression grammar example.<span
style='mso-spacerun:yes'>  </span>We have shown the workings of the LPG
generator and many features of its Java runtime.<span
style='mso-spacerun:yes'>  </span>In particular, LPG options, grammar input,
table output, lexer support, parser support and action class support (including
automatic AST generation) have been described in sufficient (albeit incomplete)
detail to enable you to build real parsing tools.</p>

<p class=MsoNormal><o:p>&nbsp;</o:p></p>

</div>

</body>

</html>
